@page "/"
@using Syncfusion.Blazor.Diagram

<SfDiagramComponent @ref="diagram" ID="diagram" Height="700px" @bind-Nodes="@Nodes" @bind-Connectors="@Connectors">
    @* <Layout Type="LayoutType.ForceDirectedTree" ForceDirectedTreeLayoutSettings="@LayoutSettings"></Layout> *@
    <SnapSettings Constraints="SnapConstraints.None"></SnapSettings>
</SfDiagramComponent>

@code {
    private SfDiagramComponent diagram;
    private DiagramObjectCollection<Node> Nodes = new();
    private DiagramObjectCollection<Connector> Connectors = new();

    // ForceDirectedTreeLayoutSettings LayoutSettings = new ForceDirectedTreeLayoutSettings
    //     {
    //         RepulsionStrength = 8000,
    //         AttractionStrength = 0.7,
    //         MaximumIteration = 500,
    //         ConnectorLength = 150
    //     };

    protected override void OnInitialized()
    {
        InitializeCollection();
    }

    public void InitializeCollection()
    {
        string[] departments = { "Engineering", "Sales", "Marketing", "Operations" };
        string[] teams = { "Core", "Mobile", "Web", "Data" };
        Node parent = CreateNode("ceo", "CEO", "#2c3e50");
        Nodes.Add(parent);
        for (int i = 0; i < 4; i++)
        {
            string deptName = departments[i];
            Node child1 = CreateNode($"vp-{deptName.ToLower()}", $"VP of {deptName}", "#3498db");
            Nodes.Add(child1);
            for (int j = 0; j < 4; j++)
            {
                string teamName = teams[j];
                Node child2 = CreateNode($"dir-{deptName.ToLower()}-{teamName.ToLower()}", $"{teamName} Director", "#90caf9");
                Nodes.Add(child2);
                for (int k = 0; k < 1; k++)
                {
                    Node child3 = CreateNode($"lead-{deptName.ToLower()}-{teamName.ToLower()}", $"{teamName} Lead", "#e3f2fd");
                    Nodes.Add(child3);
                    Connectors.Add(CreateConnector(child2.ID, child3.ID));
                }
                Connectors.Add(CreateConnector(child1.ID, child2.ID));
            }
            Connectors.Add(CreateConnector(parent.ID, child1.ID));
        }
    }

    private Node CreateNode(string id, string label, string fillColor) => new Node
        {
            ID = id,
            Width = 60,
            Height = 60,
            Shape = new BasicShape() { Shape = NodeBasicShapes.Ellipse },
            Annotations = new DiagramObjectCollection<ShapeAnnotation>() { new ShapeAnnotation { Content = label } },
            Style = new ShapeStyle() { Fill = fillColor }
        };

    private Connector CreateConnector(string sourceId, string targetId) => new Connector
        {
            ID = $"{sourceId}-{targetId}",
            SourceID = sourceId,
            TargetID = targetId,
            TargetDecorator = new DecoratorSettings { Shape = DecoratorShape.None }
        };
}